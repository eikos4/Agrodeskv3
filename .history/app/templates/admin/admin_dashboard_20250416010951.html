{% extends "base.html" %}

{% block title %}Panel Principal{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4 text-success">
    <i class="bi bi-person-circle"></i> Bienvenido, {{ current_user.name }}
  </h2>
  <p class="text-muted">Panel principal — Rol: <strong>{{ current_user.role|capitalize }}</strong></p>

  {% if notificaciones %}
  <div class="alert alert-light border-start border-4 border-success shadow-sm mb-4">
    <h5><i class="bi bi-bell-fill text-success"></i> Notificaciones</h5>
    <ul class="mb-0 ps-3">
      {% for n in notificaciones %}
        <li><strong>{{ n.titulo }}</strong> — {{ n.mensaje }} <small class="text-muted">({{ n.fecha.strftime('%d-%m-%Y') }})</small></li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% if current_user.role == 'admin' %}
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card border-primary shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-person-plus"></i> Crear Perfil Técnico Agrónomo</h5>
          <p class="card-text">Registrar nuevos técnicos para supervisión de huertos, bodegas e inventario.</p>
          <a href="{{ url_for('admin.crear_tecnico') }}" class="btn btn-primary">Ir a formulario</a>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card border-warning shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title"><i class="bi bi-chat-left-dots"></i> Asignar Recomendación</h5>
          <p class="card-text">Enviar indicaciones agronómicas personalizadas a cada técnico para optimizar el rendimiento.</p>
          <a href="{{ url_for('admin.recomendar') }}" class="btn btn-warning text-white">Asignar</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Técnicos Registrados -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-light">
      <strong><i class="bi bi-people"></i> Técnicos Registrados</strong>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for tecnico in tecnicos %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          {{ tecnico.name }} — {{ tecnico.email }}
          <span class="badge bg-success">ID: {{ tecnico.id }}</span>
        </li>
        {% else %}
        <li class="list-group-item text-muted">No hay técnicos registrados aún.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Últimas Recomendaciones -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-light">
      <strong><i class="bi bi-list-check"></i> Últimas Recomendaciones Enviadas</strong>
    </div>
    <div class="card-body">
      <ul class="list-group">
        {% for r in ultimas_recomendaciones %}
        <li class="list-group-item">
          {{ r.fecha.strftime('%d-%m-%Y') }} — <strong>{{ r.tecnico.name }}</strong>: {{ r.contenido[:60] }}...
        </li>
        {% else %}
        <li class="list-group-item text-muted">Aún no se han enviado recomendaciones.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- Bodegas Registradas -->
  <h2 class="text-success mb-4"><i class="bi bi-box-seam"></i> Bodegas Registradas</h2>
  <div class="row row-cols-1 row-cols-md-2 g-4">
    {% for bodega in bodegas %}
    <div class="col">
      <div class="card border-success shadow-sm h-100">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <strong><i class="bi bi-house-door-fill"></i> {{ bodega.nombre }}</strong>
          <small>{{ bodega.huerto.nombre }}</small>
        </div>
        <div class="card-body">
          <p><i class="bi bi-geo-alt-fill text-success"></i> <strong>Ubicación:</strong> {{ bodega.ubicacion or "No especificada" }}</p>
          <p><i class="bi bi-person-circle text-success"></i> <strong>Responsable:</strong> {{ bodega.responsable.name if bodega.responsable else 'Sin asignar' }}</p>
          <a href="{{ url_for('admin.ver_quimicos', bodega_id=bodega.id) }}" class="btn btn-outline-success btn-sm mt-2">
            Ver químicos
          </a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="bi bi-info-circle"></i> No hay bodegas registradas aún.
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>
{% endblock %}
