{% extends "base.html" %}
{% block title %}Bitácora del Huerto{% endblock %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-3 text-success"><i class="bi bi-tree"></i> Bitácora: {{ huerto.nombre }}</h2>
  <div class="mb-3">
    <strong>Ubicación:</strong> {{ huerto.ubicacion or "—" }} |
    <strong>Técnico:</strong> {{ huerto.responsable.name if huerto.responsable else "Sin asignar" }}
  </div>
  <div class="mb-4">
    <a href="{{ url_for('admin.registrar_actividad_huerto', huerto_id=huerto.id) }}" class="btn btn-success">
      <i class="bi bi-plus"></i> Nueva Actividad
    </a>
    <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline-secondary">Volver</a>
  </div>
  <!-- Filtros por año/tipo -->
  <form method="get" class="row g-2 mb-4">
    <div class="col-md-3">
      <select name="anio" class="form-select">
        <option value="">Todos los años</option>
        {% for anio in lista_anios %}
          <option value="{{ anio }}" {% if anio_seleccionado==anio %}selected{% endif %}>{{ anio }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <select name="tipo" class="form-select">
        <option value="">Todas las actividades</option>
        <option value="control_plagas" {% if tipo_seleccionado=='control_plagas' %}selected{% endif %}>Control Plagas</option>
        <option value="poda" {% if tipo_seleccionado=='poda' %}selected{% endif %}>Poda</option>
        <option value="riego" {% if tipo_seleccionado=='riego' %}selected{% endif %}>Riego</option>
        <option value="fertilizacion" {% if tipo_seleccionado=='fertilizacion' %}selected{% endif %}>Fertilización</option>
        <option value="cosecha" {% if tipo_seleccionado=='cosecha' %}selected{% endif %}>Cosecha</option>
        <option value="otra" {% if tipo_seleccionado=='otra' %}selected{% endif %}>Otra</option>
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-outline-success w-100" type="submit">Filtrar</button>
    </div>
  </form>
  <!-- Bitácora: línea de tiempo -->
  <ul class="timeline">
    {% for act in actividades %}
      <li>
        <div class="card shadow-sm mb-3">
          <div class="card-header bg-light">
            <strong>{{ act.tipo|capitalize }}</strong> | <span class="text-muted">{{ act.fecha.strftime('%d-%m-%Y') }}</span>
          </div>
          <div class="card-body">
            <p class="mb-1">{{ act.descripcion }}</p>
            <div class="small text-muted">
              Responsable: {{ act.responsable }} | 
              <a href="{{ url_for('admin.detalle_actividad', actividad_id=act.id) }}">Ver detalle</a>
            </div>
          </div>
        </div>
      </li>
    {% else %}
      <li><div class="alert alert-info">No hay actividades para este filtro.</div></li>
    {% endfor %}
  </ul>
</div>
<style>
/* Simple línea de tiempo vertical */
.timeline { list-style: none; padding: 0;}
.timeline li { position: relative; margin-bottom: 1.5rem;}
.timeline li:before {
  content: "";
  position: absolute;
  left: -18px;
  top: 14px;
  width: 12px;
  height: 12px;
  background: #43a047;
  border-radius: 50%;
}
</style>
{% endblock %}
