{% extends "base.html" %}
{% block title %}Registrar Actividad en Huerto{% endblock %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-3 text-success"><i class="bi bi-journal-plus"></i> Registrar Nueva Actividad — {{ huerto.nombre }}</h2>
  <form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="mb-3">{{ form.fecha.label }} {{ form.fecha(class="form-control") }}</div>
    <div class="mb-3">{{ form.tipo.label }} {{ form.tipo(class="form-select", id="tipo-actividad") }}</div>
    <div class="mb-3">{{ form.descripcion.label }} {{ form.descripcion(class="form-control") }}</div>
    <div class="mb-3">{{ form.responsable.label }} {{ form.responsable(class="form-control") }}</div>

    <!-- Campos de plagas solo si corresponde -->
    <div id="plagas-campos" style="display: none;">
      <div class="mb-3">{{ form.plaga.label }} {{ form.plaga(class="form-control") }}</div>
      <div class="mb-3">{{ form.nivel_infestacion.label }} {{ form.nivel_infestacion(class="form-control") }}</div>
      <div class="mb-3">{{ form.producto.label }} {{ form.producto(class="form-control") }}</div>
      <div class="mb-3">{{ form.dosis.label }} {{ form.dosis(class="form-control") }}</div>
      <div class="mb-3">{{ form.resultado.label }} {{ form.resultado(class="form-control") }}</div>
    </div>

    <div class="mb-3">{{ form.fotos.label }} {{ form.fotos(class="form-control") }}</div>
    <div class="mb-3">{{ form.observaciones.label }} {{ form.observaciones(class="form-control") }}</div>
    <button type="submit" class="btn btn-success"><i class="bi bi-check2-circle"></i> Registrar</button>
    <a href="{{ url_for('admin.bitacora_huerto', huerto_id=huerto.id) }}" class="btn btn-secondary">Cancelar</a>
  </form>
</div>
<script>
  // Muestra u oculta los campos de plagas según el tipo de actividad
  function togglePlagasCampos() {
    var tipo = document.getElementById("tipo-actividad").value;
    document.getElementById("plagas-campos").style.display = (tipo === "control_plagas") ? "block" : "none";
  }
  document.getElementById("tipo-actividad").addEventListener("change", togglePlagasCampos);
  window.onload = togglePlagasCampos;
</script>
{% endblock %}
