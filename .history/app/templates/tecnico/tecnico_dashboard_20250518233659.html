{% extends "base.html" %}
{% block title %}Panel TÃ©cnico{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- TÃ­tulo y bienvenida -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="text-success mb-1"><i class="bi bi-person-circle"></i> Hola, {{ current_user.name }}</h2>
      <div class="text-muted">Panel TÃ©cnico â€” <strong>{{ current_user.role|capitalize }}</strong></div>
    </div>
    <div>
      <!-- AcciÃ³n rÃ¡pida a recomendaciones -->
      <a href="{{ url_for('tecnico.ver_recomendaciones') }}" class="btn btn-outline-success">
        <i class="bi bi-chat-dots"></i> Ver Recomendaciones
      </a>
    </div>
  </div>

  <!-- Indicadores resumen -->
  <div class="row mb-4">
    <div class="col-6 col-md-3 mb-2">
      <div class="card text-white bg-success shadow">
        <div class="card-body d-flex align-items-center">
          <i class="bi bi-tree-fill fs-2 me-3"></i>
          <div>
            <h4 class="mb-0">{{ huertos|length }}</h4>
            <small>Huertos</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3 mb-2">
      <div class="card text-white bg-info shadow">
        <div class="card-body d-flex align-items-center">
          <i class="bi bi-box-seam fs-2 me-3"></i>
          <div>
            <h4 class="mb-0">{{ bodegas|length }}</h4>
            <small>Bodegas</small>
          </div>
        </div>
      </div>
    </div>
    <div class="col-6 col-md-3 mb-2">
      <div class="card text-white bg-secondary shadow">
        <div class="card-body d-flex align-items-center">
          <i class="bi bi-clipboard-check fs-2 me-3"></i>
          <div>
            <h4 class="mb-0">{{ recomendaciones|length }}</h4>
            <small>Recomendaciones</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notificaciones -->
  {% if notificaciones %}
  <div class="alert alert-light border-start border-4 border-success shadow-sm mb-4">
    <h5><i class="bi bi-bell-fill text-success"></i> Notificaciones</h5>
    <ul class="mb-0 ps-3">
      {% for n in notificaciones %}
        <li><strong>{{ n.titulo }}</strong> â€” {{ n.mensaje }} <small class="text-muted">({{ n.fecha.strftime('%d-%m-%Y') }})</small></li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- HUERTOS -->
  <h4 class="text-success mb-3 mt-4"><i class="bi bi-tree"></i> Mis Huertos</h4>
  <div class="row g-4">
    {% for h in huertos %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card border-success shadow h-100">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <span><i class="bi bi-tree-fill"></i> {{ h.nombre }}</span>
          <span class="badge bg-light text-success">ID {{ h.id }}</span>
        </div>
        <div class="card-body">
          <p><i class="bi bi-geo-alt-fill text-success"></i> <strong>UbicaciÃ³n:</strong> {{ h.ubicacion or "â€”" }}</p>
          <p><i class="bi bi-flower2 text-success"></i> <strong>Cultivo:</strong> {{ h.tipo_cultivo or "â€”" }}</p>
          <p><i class="bi bi-rulers text-success"></i> <strong>Superficie:</strong> {{ h.superficie_ha }} ha</p>
          <p><i class="bi bi-calendar-check text-success"></i> <strong>Siembra:</strong> {{ h.fecha_siembra.strftime('%d-%m-%Y') if h.fecha_siembra else "â€”" }}</p>
        </div>
        <div class="card-footer bg-light d-flex flex-wrap gap-2 justify-content-end">
          <a href="{{ url_for('tecnico.bitacora_huerto', huerto_id=h.id) }}" class="btn btn-outline-success btn-sm">
            <i class="bi bi-journal-text"></i> BitÃ¡cora
          </a>
          <a href="{{ url_for('tecnico.registrar_actividad_huerto', huerto_id=h.id) }}" class="btn btn-outline-info btn-sm">
            <i class="bi bi-plus-lg"></i> Nueva Actividad
          </a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="bi bi-info-circle"></i> No tienes huertos asignados aÃºn.
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- RECOMENDACIONES -->
  <h4 class="text-success mb-3 mt-5"><i class="bi bi-clipboard-check"></i> Recomendaciones Recientes</h4>
  <div class="list-group shadow-sm">
    {% for r in recomendaciones %}
    <div class="list-group-item list-group-item-action border-start border-success border-4">
      <div class="d-flex w-100 justify-content-between">
        <h6 class="mb-1"><i class="bi bi-calendar-event text-success"></i> {{ r.fecha.strftime('%d-%m-%Y') }}</h6>
        {% if r.autor %}<small class="text-muted">Por: {{ r.autor.name }}</small>{% endif %}
      </div>
      <p class="mb-1">ðŸ“Œ {{ r.contenido }}</p>
    </div>
    {% else %}
    <div class="list-group-item text-muted text-center">No tienes recomendaciones aÃºn.</div>
    {% endfor %}
  </div>

  <!-- BODEGAS -->
  <h4 class="text-info mb-3 mt-5"><i class="bi bi-box-seam"></i> Mis Bodegas</h4>
  <div class="row g-4">
    {% for bodega in bodegas %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card border-info shadow h-100">
        <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
          <span><i class="bi bi-house-door-fill"></i> {{ bodega.nombre }}</span>
          <span class="badge bg-light text-info">Huerto: {{ bodega.huerto.nombre }}</span>
        </div>
        <div class="card-body">
          <p><i class="bi bi-geo-alt-fill text-info"></i> <strong>UbicaciÃ³n:</strong> {{ bodega.ubicacion or "No especificada" }}</p>
          <p><i class="bi bi-person-circle text-info"></i> <strong>Responsable:</strong> {{ bodega.responsable.name if bodega.responsable else 'Sin asignar' }}</p>
          <a href="{{ url_for('tecnico.ver_quimicos', bodega_id=bodega.id) }}" class="btn btn-outline-info btn-sm mt-2">
            <i class="bi bi-flask"></i> Ver quÃ­micos
          </a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="bi bi-info-circle"></i> No tienes bodegas asignadas aÃºn.
      </div>
    </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
