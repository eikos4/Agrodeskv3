{% extends "base.html" %}
{% block title %}Bitácora de Actividades - {{ huerto.nombre }}{% endblock %}
{% block content %}
<div class="container my-4">
  <h2 class="mb-4 text-success">Bitácora de Actividades: {{ huerto.nombre }}</h2>
  <form method="get" class="form-inline mb-4">
    <div class="form-group mr-2">
      <label for="filtro_anio" class="mr-2">Año:</label>
      <select name="anio" id="filtro_anio" class="form-control">
        <option value="">Todos</option>
        {% for anio in lista_anios %}
          <option value="{{ anio }}" {% if anio==anio_seleccionado %}selected{% endif %}>{{ anio }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="form-group mr-2">
      <label for="filtro_tipo" class="mr-2">Tipo:</label>
      <select name="tipo" id="filtro_tipo" class="form-control">
        <option value="">Todos</option>
        <option value="control_plagas" {% if tipo_seleccionado=='control_plagas' %}selected{% endif %}>Control de Plagas</option>
        <option value="poda" {% if tipo_seleccionado=='poda' %}selected{% endif %}>Poda</option>
        <option value="riego" {% if tipo_seleccionado=='riego' %}selected{% endif %}>Riego</option>
        <option value="fertilizacion" {% if tipo_seleccionado=='fertilizacion' %}selected{% endif %}>Fertilización</option>
        <option value="cosecha" {% if tipo_seleccionado=='cosecha' %}selected{% endif %}>Cosecha</option>
        <option value="otra" {% if tipo_seleccionado=='otra' %}selected{% endif %}>Otra</option>
      </select>
    </div>
    <button type="submit" class="btn btn-outline-success">Filtrar</button>
    <a href="{{ url_for('', huerto_id=huerto.id) }}" class="btn btn-success ml-3">+ Nueva Actividad</a>
  </form>

  <!-- Línea de tiempo de actividades -->
  <ul class="timeline">
    {% for actividad in actividades %}
      <li>
        <span class="badge badge-{{ 'success' if actividad.tipo == 'control_plagas' else 'primary' }}">{{ actividad.get_tipo_display() }}</span>
        <strong>{{ actividad.fecha.strftime('%d-%m-%Y') }}</strong>
        — {{ actividad.descripcion[:80] }}{% if actividad.descripcion|length > 80 %}...{% endif %}
        <br>
        <small>Responsable: {{ actividad.responsable }}</small>
        <a href="{{ url_for('detalle_actividad', actividad_id=actividad.id) }}" class="ml-2">Ver detalle</a>
      </li>
    {% else %}
      <li><em>No hay actividades registradas para este filtro.</em></li>
    {% endfor %}
  </ul>
</div>
<style>
/* Simple línea de tiempo */
.timeline { list-style: none; padding: 0; position: relative;}
.timeline li { margin-bottom: 1.5rem; padding-left: 1.5rem; border-left: 3px solid #28a745; position: relative;}
.timeline li:before { content: ""; position: absolute; left: -8px; top: 8px; width: 14px; height: 14px; background: #fff; border: 3px solid #28a745; border-radius: 50%;}
</style>
{% endblock %}
