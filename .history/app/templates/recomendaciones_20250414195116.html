{% extends "base.html" %}
{% import "macros.html" as macros with context %}

{% block title %}Mis Recomendaciones{% endblock %}

{% block content %}
<!-- Mensaje de bienvenida -->
<div class="alert alert-info text-center mb-4">
  <h4>Bienvenido a AgroCloud</h4>
  <p>
    El INGENIERO AGRONOMO, <strong>{{ current_user.creador.name }}</strong>, te estar谩 acompa帽ando con sugerencias para tu cosecha.
  </p>
  {% if not current_user.created_by %}
    <p>Este perfil no tiene un administrador asignado.</p>
  {% endif %}
</div>

<div class="row">
  <!-- Secci贸n principal de Recomendaciones Recientes -->
  <div class="col-md-8">
    <h2 class="text-success mb-4"><i class="bi bi-clipboard-check"></i> Recomendaciones Recientes</h2>
    <div class="list-group shadow-sm mb-4">
      {% for r in recomendaciones %}
        <div class="list-group-item list-group-item-action border-start border-success border-4">
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1"><i class="bi bi-calendar-event text-success"></i> {{ r.fecha.strftime('%d-%m-%Y') }}</h6>
            {% if r.autor %}
              <small class="text-muted">Emitida por: {{ r.autor.name }}</small>
            {% endif %}
          </div>
          <p class="mb-1"> {{ r.contenido }}</p>
        </div>
      {% else %}
        <div class="list-group-item text-muted text-center">No tienes recomendaciones a煤n.</div>
      {% endfor %}
    </div>
  </div>

  <!-- Secci贸n de Instrucciones T茅cnicas (para darle 茅nfasis) -->
  <div class="col-md-4">
    <div class="alert alert-success shadow-sm d-flex align-items-center mb-4">
      <i class="bi bi-megaphone fs-3 me-3"></i>
      <div>
        <h5 class="mb-1">Instrucciones T茅cnicas</h5>
        <p class="mb-0">Tu ingeniero agr贸nomo ha enviado recomendaciones para tu gesti贸n de campo.</p>
      </div>
    </div>
  </div>
</div>

<!-- Secci贸n de Huertos y Bodegas asignados -->
<div class="row">
  <!-- Huertos -->
  <div class="col-md-6">
    <h4 class="text-success mb-3"><i class="bi bi-tree"></i> Mis Huertos Asignados</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      {% for h in huertos %}
        {{ macros.render_huerto(h) }}
      {% else %}
        <div class="col-12">
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No tienes huertos asignados a煤n.
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Bodegas -->
  <div class="col-md-6">
    <h4 class="text-success mb-3"><i class="bi bi-box-seam"></i> Mis Bodegas Asignadas</h4>
    <div class="row row-cols-1 row-cols-md-2 g-4">
      {% for bodega in bodegas %}
        {{ macros.render_bodega(bodega) }}
      {% else %}
        <div class="col-12">
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle"></i> No tienes bodegas asignadas a煤n.
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Funcionalidad de actualizaci贸n para administradores -->
{% if current_user.role == 'admin' %}
  <div class="mt-4">
    <h5 class="text-info">Actualizaci贸n de Recomendaci贸n</h5>
    <p>Como administrador, puedes actualizar el estado de las recomendaciones de los t茅cnicos.</p>
    <form method="POST" action="{{ url_for('admin.actualizar_recomendacion', recomendacion_id=r.id) }}">
      <select name="estado" class="form-select">
        <option value="pendiente" {% if r.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
        <option value="aplicada" {% if r.estado == 'aplicada' %}selected{% endif %}>Aplicada</option>
      </select>
      <button type="submit" class="btn btn-outline-success btn-sm mt-2">Actualizar Estado</button>
    </form>
  </div>
{% endif %}

{% endblock %}
