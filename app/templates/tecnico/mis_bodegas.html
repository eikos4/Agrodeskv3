{% extends "base.html" %}
{% block title %}Mis Bodegas{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- T√≠tulo de p√°gina -->
  <h2 class="mb-3 text-success">
    <i class="bi bi-box-seam"></i> Bodegas a mi cargo
  </h2>

  <!-- Intro explicativa con "robot" -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body d-flex align-items-start gap-3">
      <div class="flex-shrink-0" aria-hidden="true" style="font-size:2.25rem; line-height:1">
        ü§ñ
      </div>
      <div>
        <h5 class="mb-1">Esto te recomienda tu asistente</h5>
        <p class="mb-2 text-muted" style="font-size:1.05rem">
          <strong>¬øQu√© es una bodega?</strong> Es el lugar donde guardas y controlas tus <em>qu√≠micos</em> (fertilizantes, fitosanitarios, etc.). 
          Llevar este registro te ayuda a mantener orden, seguridad y un <strong>hist√≥rico del campo</strong> para tomar mejores decisiones.
        </p>
        <ul class="mb-0 small text-muted">
          <li>Ve la cantidad disponible y el tipo de cada qu√≠mico.</li>
          <li>Consulta r√°pidamente a qu√© <strong>huerto</strong> pertenece cada bodega.</li>
          <li>Agrega nuevos qu√≠micos cuando ingresen al inventario.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Barra de b√∫squeda simple -->
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <label for="buscarBodega" class="form-label mb-1">Buscar bodega</label>
      <input id="buscarBodega" type="search" class="form-control" placeholder="Nombre, ubicaci√≥n o huerto‚Ä¶">
    </div>
  </div>

  <!-- Grid de bodegas -->
  <div class="row g-4" id="gridBodegas">
    {% for bodega in bodegas %}
      <div class="col-12 col-md-6 col-lg-4 card-bodega"
           data-name="{{ (bodega.nombre or '')|lower }}"
           data-ubic="{{ (bodega.ubicacion or '')|lower }}"
           data-huerto="{{ (bodega.huerto.nombre if bodega.huerto else '')|lower }}">
        <div class="card border-success shadow h-100 position-relative">

          <!-- Encabezado -->
          <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
            <div class="fw-semibold">
              <i class="bi bi-house-door-fill"></i> {{ bodega.nombre }}
            </div>
            <span class="badge bg-light text-success">
              Huerto: {{ bodega.huerto.nombre if bodega.huerto else "‚Äî" }}
            </span>
          </div>

          <!-- Cuerpo -->
          <div class="card-body">
            <p class="mb-1">
              <i class="bi bi-geo-alt-fill text-success"></i>
              <strong>Ubicaci√≥n:</strong> {{ bodega.ubicacion or "‚Äî" }}
            </p>
            <p class="mb-1">
              <i class="bi bi-person-badge-fill text-primary"></i>
              <strong>Responsable:</strong>
              {{ bodega.responsable.name if bodega.responsable else "‚Äî" }}
            </p>
            <p class="mb-3">
              <i class="bi bi-flask text-info"></i>
              <strong>Qu√≠micos:</strong>
              <span class="badge bg-info">{{ bodega.quimicos|length }}</span>
            </p>

            {% if bodega.quimicos %}
              <ul class="list-group list-group-flush mb-2">
                {% for q in bodega.quimicos[:3] %}
                  <li class="list-group-item d-flex justify-content-between align-items-center small">
                    <span class="text-truncate" title="{{ q.nombre }}">{{ q.nombre }}</span>
                    <span class="badge bg-secondary">{{ q.cantidad_litros or 0 }} L</span>
                  </li>
                {% endfor %}
                {% if bodega.quimicos|length > 3 %}
                  <li class="list-group-item text-end small text-muted">
                    +{{ bodega.quimicos|length - 3 }} qu√≠micos m√°s‚Ä¶
                  </li>
                {% endif %}
              </ul>
            {% else %}
              <div class="small text-muted">Sin qu√≠micos registrados a√∫n.</div>
            {% endif %}
          </div>

          <!-- Acciones -->
          <div class="card-footer bg-light d-flex flex-wrap gap-2 justify-content-end">
            <a href="{{ url_for('tecnico.ver_quimicos', bodega_id=bodega.id) }}" class="btn btn-outline-success btn-sm">
              <i class="bi bi-flask"></i> Ver Qu√≠micos
            </a>
            <a href="{{ url_for('tecnico.agregar_quimico', bodega_id=bodega.id) }}" class="btn btn-outline-primary btn-sm">
              <i class="bi bi-plus-circle"></i> Agregar Qu√≠mico
            </a>
          </div>
        </div>
      </div>
    {% else %}
      <div class="col-12">
        <div class="alert alert-info text-center mb-0">
          <i class="bi bi-info-circle"></i> No tienes bodegas asignadas a√∫n.
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- JS: filtro simple por texto -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const input = document.getElementById('buscarBodega');
  const cards = Array.from(document.querySelectorAll('.card-bodega'));

  function doFilter() {
    const t = (input.value || '').trim().toLowerCase();
    cards.forEach(c => {
      const hit = [c.dataset.name, c.dataset.ubic, c.dataset.huerto].some(v => (v||'').includes(t));
      c.style.display = (!t || hit) ? '' : 'none';
    });
  }
  input?.addEventListener('input', doFilter);
});
</script>

<!-- Accesibilidad & legibilidad -->
<style>
/* Subir un poquito el tama√±o de fuente general del bloque */
.container { font-size: 1.02rem; }

/* Mejoras de foco para navegaci√≥n por teclado */
.card a:focus, .btn:focus, .form-control:focus, .form-select:focus {
  box-shadow: 0 0 0 .2rem rgba(25,135,84,.25) !important; /* verde bootstrap */
  outline: none;
}

/* Asegurar buen contraste en badges claros */
.badge.bg-light.text-success { border: 1px solid #cfe9dc; }
</style>
{% endblock %}
