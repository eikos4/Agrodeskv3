{% extends "base.html" %}
{% block title %}{{ 'Nuevo' if creating else 'Editar' }} Tipo de Actividad{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- ðŸ¤– AgroBot, ocultable -->
  <div id="agrobotBox" class="card shadow-sm border-0 mb-3">
    <div class="card-body d-flex gap-3 align-items-start">
      <i class="bi bi-robot fs-1 text-success"></i>
      <div class="flex-grow-1">
        <div class="d-flex justify-content-between">
          <h5 class="mb-1">AgroBot â€” Estilos por tipo de actividad</h5>
          <button id="hideAgrobotBtn" class="btn btn-outline-secondary btn-sm">Ocultar</button>
        </div>
        <p class="small text-muted mb-2">
          Define <b>color</b>, <b>relleno</b> e <b>Ã­cono</b> (Bootstrap Icons) del tipo: riego, poda, fertilizaciÃ³n, etc.
          Estos estilos se usan en el mapa y en las listas.
        </p>
      </div>
    </div>
  </div>
  <button id="showAgrobotBtn" class="btn btn-success agrobot-fab d-none">
    <i class="bi bi-robot"></i> AgroBot
  </button>

  <div class="card shadow border-0">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">
        <i class="bi bi-palette me-2"></i>
        {{ 'Nuevo' if creating else 'Editar' }} Tipo de Actividad
      </h5>
    </div>
    <div class="card-body">
      <form method="POST" autocomplete="off">
        {{ form.hidden_tag() }}

        {% if creating %}
        <div class="mb-3">
          {{ form.key.label(class_="form-label") }}
          {{ form.key(class_="form-control", placeholder="ej: riego") }}
        </div>
        {% endif %}

        <div class="mb-3">
          {{ form.nombre.label(class_="form-label") }}
          {{ form.nombre(class_="form-control", placeholder="Nombre visible (ej: Riego)") }}
        </div>

        <div class="row g-3">
          <div class="col-md-4">
            {{ form.color.label(class_="form-label") }}
            {{ form.color(class_="form-control", placeholder="#198754") }}
          </div>
          <div class="col-md-4">
            {{ form.fill_color.label(class_="form-label") }}
            {{ form.fill_color(class_="form-control", placeholder="#19875433") }}
          </div>
          <div class="col-md-4">
            {{ form.icon.label(class_="form-label") }}
            {{ form.icon(class_="form-control", placeholder="bi-water / bi-bug / bi-scissors") }}
            <div class="form-text">Usa clases de <a href="https://icons.getbootstrap.com/" target="_blank" rel="noopener">Bootstrap Icons</a></div>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-3">
          <a href="{{ url_for('geo_types.tipos_list') }}" class="btn btn-outline-secondary">Cancelar</a>
          <button class="btn btn-success">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
(function(){
  const key='agrobot:activity_type_form';
  const b=document.getElementById('agrobotBox');
  const h=document.getElementById('hideAgrobotBtn');
  const s=document.getElementById('showAgrobotBtn');
  function set(v){ if(v){b.classList.add('d-none');s.classList.remove('d-none');}
                   else{b.classList.remove('d-none');s.classList.add('d-none');} }
  set(localStorage.getItem(key)==='1');
  h?.addEventListener('click',()=>{localStorage.setItem(key,'1');set(true);});
  s?.addEventListener('click',()=>{localStorage.setItem(key,'0');set(false);window.scrollTo({top:0,behavior:'smooth'});});
})();
</script>
<style>
.agrobot-fab{
  position:fixed; right:1rem; bottom:1rem; z-index:1050;
  display:inline-flex; align-items:center; gap:.5rem;
  box-shadow:0 .5rem 1rem rgba(0,0,0,.15);
}
</style>
{% endblock %}
